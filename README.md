ETL Pipeline for Retail Data

Описание проекта:

Построен промышленный ETL-пайплайн для загрузки данных из разнородных Excel-файлов в PostgreSQL с сохранением полной историчности (SCD Type 2) и верификацией целостности. Архитектура поддерживает отказоустойчивость, масштабируемость и готова к использованию для аналитики.


Цель

- Автоматизировать загрузку Excel-данных в хранилище данных.

- Гарантировать целостность при переносе (MD5-хэши, контроль строк).

- Обеспечить хранение историчности (SCD2).

- Построить нормализованную аналитическую модель «снежинка».


Архитектура решения

STG → ODS (SCD2) → DDS («снежинка»)

STG (Staging): зеркало источника, с верификацией хэшей.

ODS (Operational Data Store): хранение историчности, реализация SCD Type 2.

DDS (Data Distribution Store): нормализованная схема для аналитики (3НФ).


Технологический стек

Orchestration: Apache Airflow

Processing: Python (Pandas, SQLAlchemy, hashlib)

Database: PostgreSQL

Verification: MD5 checksums, row counts


Структура проекта
etl-retail-pipeline/
dags/               # DAG-и Airflow
sql/                # SQL-скрипты для создания/загрузки таблиц
docs/               # Документация, скриншоты, графов DAG, папка с источником данных
requirements.txt
README.md

Реализованные DAG-и
1. stg_load_with_verification

- Загрузка Excel-файлов в STG-таблицы.

- Проверка целостности через MD5-хэши.

- Триггер запуска DAG для ODS.

2. ods_scd2_load

- Реализация SCD Type 2 для всех сущностей.

- Отслеживание изменений и хранение историчности.

- Поддержка составных бизнес-ключей.

3. dds_load

Построение нормализованной схемы «снежинка».

- Загрузка измерений и фактов.

- Оптимизация индексацией.

- Тестирование

STG: проверка целостности при загрузке (MD5).

ODS: проверка корректности историчности (SCD2).

DDS: проверка нормализации, отсутствия дубликатов, корректности связей.

Сквозное тестирование: консистентность данных на всех слоях, совпадение агрегатов.

Пример аналитического запроса
SELECT 
    b.brand_name,
    SUM(t.revenue_with_vat) AS total_revenue,
    SUM(t.discount_amount) AS total_discount,
    SUM(t.gross_profit) AS total_profit
FROM transaction t
JOIN product p ON t.product_id = p.product_id
JOIN product_group pg ON p.line_id = pg.group_id
JOIN brand b ON pg.brand_id = b.brand_id
GROUP BY b.brand_name
ORDER BY total_revenue DESC
LIMIT 10;

Результаты

- Автоматизирована загрузка из Excel-источников.

- Реализована проверка целостности данных.

- Построено историчное хранилище с SCD2.

- Создана аналитическая модель «снежинка».

- Подтверждена консистентность данных на всех слоях.


Возможности развития

- Интеграция с BI-системами (Power BI, Tableau).

- Добавление мониторинга качества данных (data quality checks).

- Поддержка новых источников и инкрементальной загрузки.
